FROM oven/bun:canary-debian

ENV DEBIAN_FRONTEND=noninteractive

# /app workdir

WORKDIR /app
# Install Python, make, compiler and musl headers for building native modules
RUN apt-get update && \
  apt-get install -y python3 make gcc g++

COPY ./drizzle .
COPY ./scripts .
COPY ./bun.lock .
COPY ./package.json .
COPY ./drizzle.config.ts .

# Install all packages
RUN bun install

# Run migrations
CMD [ "bun", "run", "migration:apply" ]